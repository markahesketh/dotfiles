#!/bin/bash
#
# Create a git worktree with a new branch
# Outputs the worktree path on success (for use with cd wrapper)
#

set -e

if [ -z "$1" ]; then
    echo "Usage: worktree <branch-name>" >&2
    exit 1
fi

branch="$1"
repo_root=$(git rev-parse --show-toplevel 2>/dev/null)

if [ -z "$repo_root" ]; then
    echo "Error: Not in a git repository" >&2
    exit 1
fi

repo_name=$(basename "$repo_root")
worktree_path="$(dirname "$repo_root")/${repo_name}--${branch}"

git worktree add -b "$branch" "$worktree_path" >&2

# Output the path for the cd wrapper
echo "$worktree_path"
