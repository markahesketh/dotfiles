# If not running interactively, don't do anything
[ -z "$PS1" ] && return

# ------------------------------------------------------------------------------
# Directories and navigation
# ------------------------------------------------------------------------------
if [[ "$OSTYPE" == "darwin"* ]]; then
    alias ls="ls -G"
else
    alias ls="ls -A --color=auto"
fi
alias ll="ls -lh"
alias lla="ls -alh"

# ------------------------------------------------------------------------------
# Confirmation messages
# ------------------------------------------------------------------------------
alias rm='rm -iv'
alias mv='mv -iv'

# ------------------------------------------------------------------------------
# Docker
# ------------------------------------------------------------------------------
alias dcd="docker-compose down"
alias dcu="docker-compose up"

# ------------------------------------------------------------------------------
# Git
# ------------------------------------------------------------------------------
alias delete-squashed='git checkout -q master && git for-each-ref refs/heads/ "--format=%(refname:short)" | while read branch; do mergeBase=$(git merge-base master $branch) && [[ $(git cherry master $(git commit-tree $(git rev-parse $branch^{tree}) -p $mergeBase -m _)) == "-"* ]] && git branch -D $branch; done'
function gho() {
    local repo_url=`git remote get-url origin | sed -e 's/git@//' -e 's/.git//' -e 's/:/\//'`
    open "https://$repo_url"
}

function ghu() {
     local repo_url=`git remote get-url upstream | sed -e 's/git@//' -e 's/.git//' -e 's/:/\//'`
     open "https://$repo_url"
}

# ------------------------------------------------------------------------------
# Workmux
# ------------------------------------------------------------------------------
alias wm="workmux"

# ------------------------------------------------------------------------------
# Lazygit
# ------------------------------------------------------------------------------
alias lg="lazygit"

# ------------------------------------------------------------------------------
# PHP / Laravel
# ------------------------------------------------------------------------------
alias art="php artisan"
alias c="composer"
alias c1="/usr/local/bin/composer1"
alias c2="/usr/local/bin/composer"

# ------------------------------------------------------------------------------
# Ruby on Rails
# ------------------------------------------------------------------------------
alias check="./bin/check"
alias lint="./bin/lint"
alias d="./bin/dev"
alias con="bin/rails c"
alias r="./bin/rails"
_uses_rspec() { [ -f .rspec ] || [ -d spec ]; }
t() { if _uses_rspec; then bundle exec rspec "$@"; else ./bin/rails test "$@"; fi; }
ta() { if _uses_rspec; then bundle exec rspec "$@"; else ./bin/rails test:all "$@"; fi; }
ts() { if _uses_rspec; then bundle exec rspec spec/system "$@"; else ./bin/rails test:system "$@"; fi; }
tt() { if _uses_rspec; then bundle exec rspec --fail-fast "$@"; else ./bin/rails test -f "$@"; fi; }

# ------------------------------------------------------------------------------
# Projects
# ------------------------------------------------------------------------------
alias mh="cd ~/Code/markahesketh/markhesketh.com"
alias tv="cd ~/Code/markahesketh/thevamoose.com"

# ------------------------------------------------------------------------------
# AI Tools
# ------------------------------------------------------------------------------
alias cl="claude"
alias cx="codex"

# ------------------------------------------------------------------------------
# Misc
# ------------------------------------------------------------------------------
alias x='exit'

# Set terminal tab title
function tab() {
    printf '\e]1;%s\a' "$1"
}

# Reload the shell (i.e. invoke as a login shell)
function reload() {
    source ~/.zshrc
    exec $SHELL -l
}

# Add the kamal SSH key to the ssh-agent
function ssh-add-kamal() {
    eval "$(ssh-agent -s)"
    ssh-add ~/.ssh/id_ed25519_kamal
}

# Refresh dotfiles symlinks and reload shell
function dotfiles() {
    local dotfiles_dir="$HOME/Code/markahesketh/dotfiles"
    if [ -d "$dotfiles_dir" ]; then
        cd "$dotfiles_dir" && ./bin/dotfiles
    else
        echo "Dotfiles directory not found at $dotfiles_dir"
    fi
}

# Local config
[[ -f ~/.aliases.local ]] && source ~/.aliases.local
